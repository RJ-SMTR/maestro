resources:
  basedosdados_config:
    config:
      table_id: rho5_registros_stpl
      dataset_id: br_rj_riodejaneiro_rdo
  timezone_config:
    config:
      timezone: "America/Sao_Paulo"
  discord_webhook:
    config:
      url: "{{ '' | env_override('SPPO_DISCORD_WEBHOOK') }}"
      success_cron: "* * * * *"
solids:
  download_file_from_ftp:
    ftp_path:
      value: SPPO/ARQUIVO.TXT
    local_path:
      value: /tmp/ARQUIVO.TXT
  parse_file_path_and_partitions:
    bucket_path:
      value: raw/br_rj_riodejaneiro_rdo/rho5_registros_stpl/ano=2021/mes=01/dia=07/RDO_00638_00001_20210307_20210312_045044.csv
  aux_get_list:
    filename: raw/br_rj_riodejaneiro_rdo/aux_riocard_permissionarios/2021-12-16.csv
    read_csv_kwargs:
      delimiter: ","
      index_col: "CD_OPERAD"
      usecols:
        - "CD_OPERAD"
        - "MODAL"
        - "NM_RAZAO_SOCIAL"
    filter:
      MODAL: "VANS_MUNIC"
    extract: 
      col: "NM_RAZAO_SOCIAL"
      pattern: '(?:VAN)(\d+)'
  upload_to_bigquery:
    modes:
      value:
        - staging
  load_and_transform_csv:
    config:
      read_csv_kwargs:
        delimiter: ";"
        index_col: false
      map:
        operadora: codigo
      reindex_kwargs:
        columns:
          - operadora
          - linha
          - data_transacao
          - hora_transacao
          - total_gratuidades
          - total_pagantes
          - codigo
